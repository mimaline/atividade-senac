<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desenvolvimento - Tech</title>
    <link rel="stylesheet" href="css/alunos.css">
    <link rel="stylesheet" href="css/exercises.css">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
</head>

<body>
    <div class="container-principal">
        <!-- Inclui o Menu Unico Atraves de JavaScript -->
        <div include-html-menu="menu.html"></div>
        <div class="container">
            <div class="lista-exercicio">
                <ul>
                    <li><button onclick="loadDados('202101')">202101</button>Dados Rio do Sul</li>
                    <li><button onclick="loadDados('202102')">202102</button>Dados Rio do Sul</li>
                    <li><button onclick="loadDados('202103')">202103</button>Dados Rio do Sul</li>
                    <li><button onclick="loadDados('202104')">202104</button>Dados Rio do Sul</li>
                    <li><button onclick="loadDados('202105')">202105</button>Dados Rio do Sul</li>
                </ul>
            </div>

            <table class="container-table">
                <thead>
                    <tr>
                        <th class="containerTable-lblTitle">Mes</th>
                        <th class="containerTable-lblTitle">Parcela</th>
                        <th class="containerTable-lblTitle">Nome</th>
                        <th class="containerTable-lblTitle">Valor</th>
                        <th class="containerTable-lblTitle">NIS</th>
                    </tr>
                </thead>
                <tbody class="containerTable-body">
                    <!--PREENCHIDO ATRAVES DE JAVASCRIPT!!!-->
                </tbody>
            </table>
        </div>
        <div class="container" id="root"></div>
    </div>
</body>

<script>
    function loadDados(mes) {
        var url = "https://api.portaldatransparencia.gov.br/api-de-dados/auxilio-emergencial-beneficiario-por-municipio";

        if (mes == undefined) {
            mes = 202101;
        }

        var params = "?codigoIbge=4214805&mesAno=" + mes + "&pagina=1";


        url = url + params;

        var token = "e87c65b7590a28a987705526d3812c4a&LOADBALANCERPKSTRING";
        var token = "e87c65b7590a28a987705526d3812c4a";

        let body = document.querySelector(".containerTable-body");

        const status = "dados";

        const status_exercise = "status_separate_exercises";
        const nova_lista = "Dados MÃªs:" + mes;
        body.innerHTML += `<tr>
                                <td class="containerTable-lblValue ` + status_exercise + `">` + nova_lista + `</td>
                                <td class="containerTable-lblValue ` + status_exercise + `">` + nova_lista + `</td>
                                <td class="containerTable-lblValue ` + status_exercise + `">` + nova_lista + `</td>
                                <td class="containerTable-lblValue ` + status_exercise + `">` + nova_lista + `</td>
                                <td class="containerTable-lblValue ` + status_exercise + `">` + nova_lista + `</td>
                        </tr>`;


        fetch(url, {
                headers: {
                    "Accept": "application/vnd.github.v3+json",
                    "chave-api-dados": token
                }
            })
            // Converting the response to a JSON object
            .then(response => response.json())
            .then(data => {
                var codigo = 1;
                var link_github = 1;
                var nome = 1;
                var data_status = 1;
                var observacao = 1;


                data.forEach(function(value, key) {
                    debugger;

                    const beneficiario = value.beneficiario;
                    var mes = value.mesDisponibilizacao;
                    var numeroParcela = value.numeroParcela;
                    var valor = value.valor;

                    var nis = beneficiario.nis;
                    var nome = beneficiario.nome;


                    body.innerHTML += `<tr>
                                    <td class="containerTable-lblValue ` + status + ` center">` + mes + `</td>
                                    <td class="containerTable-lblValue ` + status + `">` + numeroParcela + `</td>
                                    <td class="containerTable-lblValue ` + status + `">` + nome + `</td>
                                    <td class="containerTable-lblValue ` + status + ` center">` + valor + `</td>
                                    <td class="containerTable-lblValue ` + status + `">` + nis + `</td>
                                </tr>`;
                });



                console.log(data);
            });

    }
</script>

</html>